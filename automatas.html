<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>PDA — Lenguaje L = { x* y^{2n} z^m z^{m+2} y^{3n} }</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont,
        "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      background: #0b1120;
      color: #e5e7eb;
    }
    header {
      text-align: center;
      padding: 16px 8px;
      background: #020617;
      border-bottom: 1px solid #1e293b;
    }
    header h1 {
      margin: 2px 0;
      font-size: 1.2rem;
      color: #f97316;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    header h2 {
      margin: 2px 0;
      font-size: 0.95rem;
      color: #e5e7eb;
    }
    header h3 {
      margin: 4px 0;
      font-size: 1rem;
      color: #22c55e;
    }

    main {
      padding: 16px;
      max-width: 1200px;
      margin: 0 auto 40px auto;
    }

    .grid {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 16px;
    }
    @media (max-width: 900px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    .card {
      background: #020617;
      border-radius: 12px;
      padding: 16px;
      border: 1px solid #1e293b;
      box-shadow: 0 10px 25px rgba(0,0,0,0.6);
      margin-bottom: 16px;
    }
    .card h3 {
      margin-top: 0;
      margin-bottom: 8px;
      font-size: 1.05rem;
      color: #38bdf8;
    }
    .card h4 {
      margin: 8px 0;
      font-size: 0.95rem;
      color: #a5b4fc;
    }
    label {
      font-size: 0.9rem;
      font-weight: 600;
      display: block;
      margin-bottom: 4px;
    }
    input[type="text"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #1f2937;
      background: #020617;
      color: #e5e7eb;
      font-size: 0.95rem;
    }
    input[type="text"]::placeholder {
      color: #6b7280;
    }
    .botones {
      margin-top: 8px;
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      align-items: center;
    }
    button {
      padding: 8px 14px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      color: #f9fafb;
      background: #0ea5e9;
    }
    button.segundo {
      background: #0284c7;
    }
    button:hover {
      filter: brightness(1.05);
      transform: translateY(-1px);
    }
    .velocidad {
      margin-top: 4px;
      font-size: 0.85rem;
      color: #cbd5f5;
      display: flex;
      gap: 4px;
      flex-wrap: wrap;
      align-items: center;
    }
    .velocidad label {
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin-bottom: 0;
    }
    .resultado {
      margin-top: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      font-weight: 600;
      font-size: 0.9rem;
      display: none;
    }
    .aceptada {
      display: block;
      background: rgba(34,197,94,0.08);
      border: 1px solid #22c55e;
      color: #bbf7d0;
    }
    .rechazada {
      display: block;
      background: rgba(248,113,113,0.08);
      border: 1px solid #f97373;
      color: #fecaca;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
      font-size: 0.8rem;
    }
    thead {
      background: #020617;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    th, td {
      border: 1px solid #1f2937;
      padding: 4px 6px;
      text-align: center;
    }
    th {
      color: #e5e7eb;
      font-weight: 600;
    }
    tbody {
      background: #020617;
    }
    .tabla-contenedor {
      max-height: 320px;
      overflow-y: auto;
      border-radius: 8px;
      border: 1px solid #1f2937;
      margin-top: 6px;
    }

    .lista-di {
      margin-top: 10px;
      max-height: 200px;
      overflow-y: auto;
      border-radius: 8px;
      border: 1px solid #1f2937;
      padding: 8px;
      font-size: 0.82rem;
      background: #020617;
    }
    .lista-di li {
      margin-bottom: 4px;
    }

    code {
      background: #020617;
      padding: 1px 4px;
      border-radius: 4px;
      font-size: 0.85rem;
    }
    pre {
      background: #020617;
      border-radius: 8px;
      padding: 8px;
      font-size: 0.82rem;
      overflow-x: auto;
      white-space: pre-wrap;
    }
    .small {
      font-size: 0.85rem;
    }
  </style>
</head>
<body>
<header>
  <h1>PDA — Lenguaje L = { x* y<sup>2n</sup> z<sup>m</sup> z<sup>m+2</sup> y<sup>3n</sup> | n ≥ 1, m ≥ 2 }</h1>
  <h2>Autómatas y Lenguajes Formales</h2>
</header>

<main>
  <div class="grid">
    <!-- IZQUIERDA: entrada + diagrama + descripción -->
    <section>
      <div class="card">
        <h3>Ingrese cadena (x,y,z)</h3>
        <label for="cadena">Cadena a evaluar:</label>
        <input id="cadena" type="text" placeholder="Ejemplo: yyzzzzzzyyy" />

        <div class="botones">
          <button id="btnComprobar">Comprobar</button>
          <button id="btnEjemplo" class="segundo">Cargar ejemplo</button>
          <div class="velocidad">
            <span>Velocidad:</span>
            <label><input type="radio" name="velocidad" value="lenta"> Lenta</label>
            <label><input type="radio" name="velocidad" value="normal" checked> Normal</label>
            <label><input type="radio" name="velocidad" value="rapida"> Rápida</label>
          </div>
        </div>

        <div id="mensajeResultado" class="resultado"></div>
      </div>

      <div class="card">
        <h3>Diagrama del PDA (esquema)</h3>
        <pre>
q0   q1   q2   q3   q4

Transiciones (idea):
- q0 --x, λ ; λ--> q0         ignora x
- q0/q1 --y, λ ; Y--> q1      primer bloque de y
- q1 --z, λ ; λ--> q2         entra al bloque de z
- q2 --z, λ ; Z--> q2         recorre los z
- q2/q3 --y, Z ; λ--> q3      bloque final de y
- q3 --λ, Z0 ; Z0--> q4       aceptación
        </pre>
      </div>

      <div class="card">
        <h3>Descripción formal (resumen)</h3>
        <pre>
M = (Q, Σ, Γ, δ, q0, Z0, F)
Q = {q0,q1,q2,q3,q4}
Σ = {x,y,z}
Γ = {Z0,Y,Z}
q0 estado inicial
Z0 símbolo inicial de la pila
F = {q4}
        </pre>
      </div>
    </section>

    <!-- DERECHA: tabla + descripción instantánea -->
    <section>
      <div class="card">
        <h3>Tabla de pasos</h3>
        <div class="tabla-contenedor">
          <table>
            <thead>
              <tr>
                <th>Paso</th>
                <th>Símbolo</th>
                <th>Estado</th>
                <th>Tope pila</th>
                <th>Acción</th>
                <th>Nuevo estado</th>
                <th>Pila</th>
              </tr>
            </thead>
            <tbody id="tablaPasos">
              <!-- dinámico -->
            </tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <h3>Descripción instantánea (lista)</h3>
        <ul id="listaDI" class="lista-di">
          <!-- dinámico -->
        </ul>
      </div>
    </section>
  </div>
</main>

<script>
  const inputCadena   = document.getElementById("cadena");
  const btnComprobar  = document.getElementById("btnComprobar");
  const btnEjemplo    = document.getElementById("btnEjemplo");
  const msgResultado  = document.getElementById("mensajeResultado");
  const tablaPasos    = document.getElementById("tablaPasos");
  const listaDI       = document.getElementById("listaDI");
  const radiosVel     = document.querySelectorAll("input[name='velocidad']");

  let animTimer = null;

  function obtenerVelocidadMs() {
    let val = "normal";
    radiosVel.forEach(r => {
      if (r.checked) val = r.value;
    });
    if (val === "lenta") return 800;
    if (val === "rapida") return 150;
    return 400; // normal
  }

  function mostrarResultado(resultado) {
    msgResultado.style.display = "block";
    if (resultado.aceptada) {
      msgResultado.textContent = "CADENA ACEPTADA ✅";
      msgResultado.className = "resultado aceptada";
    } else {
      msgResultado.textContent = "CADENA RECHAZADA ❌  " + resultado.motivo;
      msgResultado.className = "resultado rechazada";
    }
  }

  function limpiarSalidas() {
    if (animTimer) {
      clearInterval(animTimer);
      animTimer = null;
    }
    tablaPasos.innerHTML = "";
    listaDI.innerHTML = "";
  }

  function iniciarAnimacion(steps) {
    limpiarSalidas();
    const delay = obtenerVelocidadMs();
    let i = 0;
    animTimer = setInterval(() => {
      if (i >= steps.length) {
        clearInterval(animTimer);
        animTimer = null;
        return;
      }
      const s = steps[i];

      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${s.paso}</td>
        <td><code>${s.simbolo}</code></td>
        <td>${s.estadoAntes}</td>
        <td><code>${s.topeAntes}</code></td>
        <td style="text-align:left;">${s.accion}</td>
        <td>${s.estadoDespues}</td>
        <td><code>${s.pilaDespues}</code></td>
      `;
      tablaPasos.appendChild(tr);

      const li = document.createElement("li");
      li.textContent = `DI ${s.paso}: (${s.estadoDespues}, ${
        s.resto === "" ? "λ" : s.resto
      }, ${s.pilaDespues})`;
      listaDI.appendChild(li);

      i++;
    }, delay);
  }

  function simularCadena(cadena) {
    const steps = [];
    let pasoNum = 1;

    let state = "q0";
    let stack = ["Z0"];

    let i = 0;
    const nCadena = cadena.length;

    let phase = "prefix"; // prefix, y1, z, y2
    let y1Count = 0;
    let zCount = 0;
    let y2Count = 0;

    function registrarPaso(simbolo, estadoAntes, estadoDespues, pilaAntesArr, pilaDespuesArr, accion, idxDespues) {
      const topeAntes = pilaAntesArr[pilaAntesArr.length - 1] || "∅";
      const pilaDespues = pilaDespuesArr.join("");
      const resto = cadena.slice(idxDespues);
      steps.push({
        paso: pasoNum++,
        simbolo: simbolo === "" ? "λ" : simbolo,
        estadoAntes,
        estadoDespues,
        topeAntes,
        accion,
        pilaDespues,
        resto
      });
    }

    while (i < nCadena) {
      const c = cadena[i];

      // PREFIJO x*
      if (phase === "prefix") {
        if (c === "x") {
          const estadoAntes = state;
          const pilaAntes = stack.slice();
          const accion = "leer x (prefijo libre)";
          registrarPaso("x", estadoAntes, state, pilaAntes, stack.slice(), accion, i + 1);
          i++;
          continue;
        }
        if (c === "y") {
          phase = "y1";
          // cae a la parte de y1 para este mismo símbolo
        } else {
          return { aceptada: false, motivo: "Símbolo inválido en el prefijo (solo x* permitido).", steps };
        }
      }

      // PRIMER BLOQUE y^{2n}
      if (phase === "y1") {
        if (c === "y") {
          const estadoAntes = state;
          const pilaAntes = stack.slice();

          if (y1Count === 0) {
            state = "q1";
            stack.push("Y");
            y1Count++;
            const accion = "leer y inicio";
            registrarPaso("y", estadoAntes, state, pilaAntes, stack.slice(), accion, i + 1);
          } else {
            state = "q1";
            stack.push("Y");
            y1Count++;
            const accion = "leer y (y1)";
            registrarPaso("y", estadoAntes, state, pilaAntes, stack.slice(), accion, i + 1);
          }

          i++;
          continue;
        }

        if (c === "z") {
          if (y1Count < 2 || y1Count % 2 !== 0) {
            return {
              aceptada: false,
              motivo: `El primer bloque de 'y' debe tener longitud 2n (n≥1). Se leyó ${y1Count}.`,
              steps
            };
          }
          phase = "z";
          // cae a bloque z
        } else {
          return { aceptada: false, motivo: "Después del primer bloque de y solo puede venir 'z'.", steps };
        }
      }

      // BLOQUE DE z (z^m z^{m+2}) -> total 2m+2, par y ≥ 6
      if (phase === "z") {
        if (c === "z") {
          const estadoAntes = state;
          const pilaAntes = stack.slice();

          if (zCount === 0) {
            // primera z: cambia a q2, no modifica pila
            state = "q2";
            zCount++;
            const accion = "leer z";
            registrarPaso("z", estadoAntes, state, pilaAntes, stack.slice(), accion, i + 1);
          } else {
            // resto: en q2, apilar Z
            state = "q2";
            stack.push("Z");
            zCount++;
            const accion = "leer z";
            registrarPaso("z", estadoAntes, state, pilaAntes, stack.slice(), accion, i + 1);
          }

          i++;
          continue;
        }

        if (c === "y") {
          if (zCount < 6 || zCount % 2 !== 0) {
            return {
              aceptada: false,
              motivo: `El bloque de 'z' debe tener longitud 2m+2 con m≥2 (par y ≥ 6). Se leyó ${zCount}.`,
              steps
            };
          }
          phase = "y2";
          // cae al bloque final de y
        } else {
          return { aceptada: false, motivo: "Solo se permiten 'z' en el bloque central, luego 'y'.", steps };
        }
      }

      // BLOQUE FINAL y^{3n}
      if (phase === "y2") {
        if (c === "y") {
          const estadoAntes = state;
          const pilaAntes = stack.slice();

          if (y2Count === 0) {
            // primera y del bloque final
            state = "q3";
            const accion = "inicio y finales";
            y2Count++;
            registrarPaso("y", estadoAntes, state, pilaAntes, stack.slice(), accion, i + 1);
          } else {
            state = "q3";
            // en el ejemplo se ve que se van quitando Z al final
            if (stack[stack.length - 1] === "Z") {
              stack.pop();
            }
            y2Count++;
            const accion = "leer y final (grupo)";
            registrarPaso("y", estadoAntes, state, pilaAntes, stack.slice(), accion, i + 1);
          }

          i++;
          continue;
        } else {
          return { aceptada: false, motivo: "El bloque final solo puede contener 'y'.", steps };
        }
      }
    } // while

    // Validaciones finales
    if (phase !== "y2") {
      return {
        aceptada: false,
        motivo: "La cadena termina antes de completar todas las partes del patrón.",
        steps
      };
    }

    const n = y1Count / 2;
    if (y2Count !== 3 * n) {
      return {
        aceptada: false,
        motivo: `El bloque final de 'y' debe tener longitud 3n. Se esperaba ${3 * n} y se leyó ${y2Count}.`,
        steps
      };
    }

    if (zCount < 6 || zCount % 2 !== 0) {
      return {
        aceptada: false,
        motivo: `El bloque de 'z' debe tener longitud 2m+2 con m≥2 (par y ≥ 6). Se leyó ${zCount}.`,
        steps
      };
    }

    // Paso de aceptación λ
    const estadoAntes = state;
    const pilaAntes = stack.slice();
    state = "q4";
    const accionFinal = "λ, transición de aceptación (fin de cadena y condiciones cumplidas).";
    registrarPaso("", estadoAntes, state, pilaAntes, stack.slice(), accionFinal, nCadena);

    return {
      aceptada: true,
      motivo: "",
      steps
    };
  }

  // Eventos
  btnComprobar.addEventListener("click", () => {
    const cadena = inputCadena.value.trim();

    if (!cadena) {
      mostrarResultado({ aceptada: false, motivo: "Ingrese una cadena para simular." });
      limpiarSalidas();
      return;
    }

    if (!/^[xyz]+$/.test(cadena)) {
      mostrarResultado({ aceptada: false, motivo: "Solo se permiten los símbolos x, y y z." });
      limpiarSalidas();
      return;
    }

    const resultado = simularCadena(cadena);
    mostrarResultado(resultado);
    iniciarAnimacion(resultado.steps);
  });

  btnEjemplo.addEventListener("click", () => {
    // ejemplo del screenshot: yy zzzzzz yyy
    inputCadena.value = "yyzzzzzzyyy";
  });
</script>
</body>
</html>
