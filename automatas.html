<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Simulador de PDA</title>
  <style>
    body{
      font-family: Arial, sans-serif;
      margin:20px;
    }
    h1{
      margin-bottom: 0;
    }
    .card{
      border:1px solid #ccc;
      padding:16px;
      border-radius:8px;
      margin-top:16px;
    }
    label,input,button{
      font-size: 1rem;
    }
    input[type="text"]{
      padding:4px 8px;
      width:260px;
    }
    button{
      padding:6px 12px;
      margin-left:8px;
      cursor:pointer;
    }
    table{
      border-collapse: collapse;
      margin-top:16px;
      width:100%;
      max-width:520px;
    }
    th,td{
      border:1px solid #aaa;
      padding:4px 6px;
      text-align:center;
      font-size:0.9rem;
    }
    th{
      background:#eee;
    }
    #resultado{
      margin-top:12px;
      font-weight:bold;
    }
  </style>
</head>
<body>
  <h1>Simulador de Autómata de Pila</h1>
  <p><strong>Ejercicio:</strong> Usa el PDA de JFLAP (q0, q1, q2, pila con Z al inicio) y pruébalo aquí.</p>

  <div class="card">
    <label for="cadena">Cadena de entrada:</label>
    <input id="cadena" type="text" placeholder="escribe algo como: yyzzzzzyyyyyy" />
    <button onclick="simular()">Simular</button>
    <div id="resultado"></div>

    <table id="tablaTraza">
      <thead>
        <tr>
          <th>Paso</th>
          <th>Estado</th>
          <th>Entrada restante</th>
          <th>Pila</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </div>

  <script>
    // ========= 1. Definición del PDA =========
    // Ajusta estas transiciones para que coincidan EXACTAMENTE
    // con tu autómata de JFLAP.
    //
    // Campos:
    //  from  -> estado actual
    //  input -> símbolo de entrada (o "ε" para épsilon)
    //  pop   -> símbolo que se saca de la pila
    //  push  -> cadena que se mete a la pila (puede ser "ε")
    //  to    -> nuevo estado
    const PDA = {
      initialState: "q0",
      initialStackSymbol: "Z",
      acceptingStates: ["q2"],   // pon aquí tus estados de aceptación
      transitions: [
        // EJEMPLOS (CÁMBIALOS POR LOS DE TU PDA)
        // --- Bloque inicial de y's (parecido a tu captura) ---
        { from: "q0", input: "y", pop: "Z", push: "11Z", to: "q1" },
        { from: "q1", input: "y", pop: "1", push: "11",  to: "q1" },

        // --- Cambio a z's, pasamos a q2 y empezamos a meter 0s ---
        // (SOLO EJEMPLO)
        { from: "q1", input: "z", pop: "1", push: "0011", to: "q2" },
        { from: "q2", input: "z", pop: "1", push: "00",   to: "q2" },

        // Transición de épsilon para empezar a consumir el último bloque de y's
        { from: "q2", input: "ε", pop: "0", push: "ε",    to: "q2" },
        { from: "q2", input: "y", pop: "1", push: "ε",    to: "q2" }
      ]
    };

    // ========= 2. Función de simulación =========
    function simular() {
      const input = document.getElementById("cadena").value.trim();
      const tbody = document.querySelector("#tablaTraza tbody");
      const resultado = document.getElementById("resultado");

      // Limpiar tabla y mensaje
      tbody.innerHTML = "";
      resultado.textContent = "";

      if (input === "") {
        resultado.textContent = "Ingresa una cadena primero.";
        resultado.style.color = "red";
        return;
      }

      let state = PDA.initialState;
      let stack = [PDA.initialStackSymbol];
      let remaining = input;
      let paso = 0;

      // Configuración inicial (como la primera fila de JFLAP)
      agregarFila(tbody, paso, state, remaining, stack);

      let seguro = 0;
      const maxPasos = 200;

      while (seguro < maxPasos) {
        seguro++;

        const simboloEntrada = remaining.length > 0 ? remaining[0] : null;
        const tope = stack.length > 0 ? stack[stack.length - 1] : null;

        const transicion = buscarTransicion(state, simboloEntrada, tope);

        if (!transicion) break; // ya no hay movimientos posibles

        // Sacar de la pila
        if (transicion.pop !== "ε" && tope === transicion.pop) {
          stack.pop();
        }

        // Meter en la pila (al revés, porque push("ab") deja 'b' arriba)
        if (transicion.push !== "ε") {
          const simbolosPush = transicion.push.split("").reverse();
          for (const s of simbolosPush) {
            stack.push(s);
          }
        }

        // Consumir símbolo de entrada (si no es épsilon)
        if (transicion.input !== "ε") {
          remaining = remaining.substring(1);
        }

        // Cambiar de estado
        state = transicion.to;
        paso++;
        agregarFila(tbody, paso, state, remaining, stack);
      }

      // Aceptación: sin entrada y en un estado aceptante
      const acepta =
        remaining.length === 0 &&
        PDA.acceptingStates.includes(state);

      if (acepta) {
        resultado.textContent = "✔ Cadena ACEPTADA";
        resultado.style.color = "green";
      } else {
        resultado.textContent = "✘ Cadena RECHAZADA";
        resultado.style.color = "red";
      }
    }

    // Busca una transición con (estado, símbolo de entrada, tope de pila)
    function buscarTransicion(state, simboloEntrada, topePila) {
      // 1) Transiciones que consumen símbolo de entrada
      if (simboloEntrada !== null) {
        for (const t of PDA.transitions) {
          if (
            t.from === state &&
            t.input === simboloEntrada &&
            (t.pop === "ε" || t.pop === topePila)
          ) {
            return t;
          }
        }
      }

      // 2) Transiciones épsilon (no consumen entrada)
      for (const t of PDA.transitions) {
        if (
          t.from === state &&
          t.input === "ε" &&
          (t.pop === "ε" || t.pop === topePila)
        ) {
          return t;
        }
      }

      return null;
    }

    // Añade una fila a la tabla de traza (como las de "Accepting configuration found")
    function agregarFila(tbody, paso, estado, entradaRestante, pilaArray) {
      const fila = document.createElement("tr");

      const cPaso = document.createElement("td");
      const cEstado = document.createElement("td");
      const cEntrada = document.createElement("td");
      const cPila = document.createElement("td");

      cPaso.textContent = paso;
      cEstado.textContent = estado;
      cEntrada.textContent = entradaRestante === "" ? "ε" : entradaRestante;
      cPila.textContent = pilaArray.length === 0 ? "ε" : pilaArray.join("");

      fila.appendChild(cPaso);
      fila.appendChild(cEstado);
      fila.appendChild(cEntrada);
      fila.appendChild(cPila);

      tbody.appendChild(fila);
    }
  </script>
</body>
</html>
